<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>To-Do List with Calendar</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <style>
    * { box-sizing: border-box; }

    body {
      font-family: Arial, sans-serif;
      background: #f0f2f5;
      color: #333;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: background 0.3s, color 0.3s;
    }
    body.dark-mode {
      background: #121212;
      color: #e0e0e0;
    }

    .todo-container {
      background: #fff;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 700px;
      margin: 2rem 0;
      transition: background 0.3s;
    }
    body.dark-mode .todo-container {
      background: #1e1e1e;
    }

    h1 { text-align: center; margin-bottom: 1rem; }

    form { display: block; margin-bottom: 1rem; }
    form .form-group {
      display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;
    }
    form .form-group.single { flex-direction: column; gap: 10px; }

    input[type="text"], input[type="date"], select {
      flex: 1;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
      background: #fff;
      color: #333;
      transition: background 0.3s, color 0.3s, border 0.3s;
    }
    body.dark-mode input[type="text"],
    body.dark-mode input[type="date"],
    body.dark-mode select {
      background: #2a2a2a;
      color: #e0e0e0;
      border-color: #555;
    }

    button {
      padding: 10px 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s;
    }
    button:hover { background-color: #0069d9; }

    ul { list-style: none; padding: 0; }
    li {
      background: #f9f9f9;
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
      transition: background 0.3s;
    }
    body.dark-mode li { background: #2a2a2a; }

    li.completed { text-decoration: line-through; color: #888; }

    .delete-btn, .restore-btn {
      background: #dc3545; color: white; border: none;
      padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.9rem;
    }
    .delete-btn:hover, .restore-btn:hover { background: #c82333; }

    .controls { display: flex; justify-content: space-between; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }

    .checkbox { margin-right: 10px; }

    #calendar { width: 90%; max-width: 900px; margin: 2rem 0; }

    #success-list, #frequent-list {
      position: fixed; right: 0; top: 80px;
      width: 250px; background: #fff; border-left: 1px solid #ccc;
      padding: 10px; max-height: 80vh; overflow-y: auto;
      transition: background 0.3s, color 0.3s, border 0.3s;
    }
    body.dark-mode #success-list,
    body.dark-mode #frequent-list {
      background: #1e1e1e; color: #e0e0e0; border-color: #444;
    }

    .success-item, .frequent-item { margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
    body.dark-mode .success-item, body.dark-mode .frequent-item { border-bottom-color: #444; }

    #top-left-buttons {
      position: fixed; top: 10px; left: 10px; display: flex; flex-direction: column; gap: 10px; z-index: 999;
    }
    #top-left-buttons button { background-color: #6c757d; }
    #top-left-buttons button:hover { background-color: #5a6268; }

    #feedback-section {
      position: fixed; bottom: 20px; left: 20px;
      background: #fff; border-radius: 10px; padding: 10px;
      box-shadow: 0 5px 10px rgba(0,0,0,0.15);
      transition: background 0.3s, color 0.3s; width: 250px;
    }
    body.dark-mode #feedback-section { background: #1e1e1e; color: #e0e0e0; }
    #feedback-input {
      border: 1px solid #ccc; border-radius: 5px; padding: 8px; resize: none; width: 100%;
    }

    .modal {
      display: none;
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.75);
      justify-content: center; align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 400px;
      width: 90%;
    }
    .modal-header { font-size: 18px; font-weight: bold; margin-bottom: 10px; }
    .modal-close {
      float: right; cursor: pointer; font-weight: bold; color: red;
    }
    body.dark-mode .modal-content {
      background: #2a2a2a;
      color: #e0e0e0;
    }
    body.dark-mode .modal-header {
      color: #fff;
    }
    body.dark-mode .modal-close {
      color: #ff6b6b; /* Îπ®Í∞ÑÏÉâ Îã´Í∏∞ Î≤ÑÌäº */
    }
  </style>
</head>
<body>
  <div id="top-left-buttons">
    <button id="reset-storage">üóë Î°úÏª¨ Ï†ÄÏû•ÏÜå Î¶¨ÏÖã</button>
    <button id="toggle-theme">üåì Îã§ÌÅ¨Î™®Îìú Ï†ÑÌôò</button>
  </div>

  <div class="todo-container">
    <h1>To-Do List</h1>
    <form id="todo-form">
      <div class="form-group single">
        <input type="text" id="todo-input" placeholder="Ìï† ÏùºÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" required />
      </div>
      <div class="form-group">
        <input type="text" id="todo-location" placeholder="Ïû•ÏÜå" />
        <select id="todo-category">
          <option value="">Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù</option>
          <option value="ÏóÖÎ¨¥">ÏóÖÎ¨¥</option>
          <option value="Í≥µÎ∂Ä">Í≥µÎ∂Ä</option>
          <option value="Ïö¥Îèô">Ïö¥Îèô</option>
          <option value="ÏïΩÏÜç">ÏïΩÏÜç</option>
          <option value="Í∏∞ÌÉÄ">Í∏∞ÌÉÄ</option>
        </select>
      </div>
      <div class="form-group">
        <input type="date" id="todo-date" />
        <input type="date" id="todo-deadline" placeholder="ÎßàÍ∞êÏùº" />
        <button type="submit">Ï∂îÍ∞Ä</button>
      </div>
    </form>

    <div class="controls">
      <button id="select-today">Ïò§Îäò Î™®Îëê ÏÑ†ÌÉù</button>
      <button id="delete-selected">ÏÑ†ÌÉù ÏÇ≠Ï†ú</button>
    </div>

    <ul id="todo-list"></ul>
    <button id="toggle-deleted">Ìú¥ÏßÄÌÜµ</button>
    <ul id="deleted-list" style="display:none;"></ul>
  </div>

  <div id="calendar"></div>

  <div id="success-list">
    <h4>‚úÖ ÏôÑÎ£åÌïú Ïùº</h4>
    <ul id="completed-todos"></ul>
  </div>
  <div id="frequent-list">
    <h4>üîÅ ÏûêÏ£º Îì±Î°ùÌïú Ìï† Ïùº</h4>
    <ul id="frequent-todos"></ul>
  </div>

  <div id="feedback-section">
    <button id="toggle-feedback">üí¨ ÌîºÎìúÎ∞± Î≥¥ÎÇ¥Í∏∞</button>
    <div id="feedback-form-container" style="display:none; margin-top:10px;">
      <textarea id="feedback-input" placeholder="ÌîºÎìúÎ∞±ÏùÑ ÏûëÏÑ±ÌïòÏÑ∏Ïöî" rows="3"></textarea>
      <button id="submit-feedback">Ï†úÏ∂ú</button>
    </div>
  </div>

  <div id="eventModal" class="modal">
    <div class="modal-content">
      <span class="modal-close" id="modalClose">&times;</span>
      <div class="modal-header">Ìï† Ïùº ÏÉÅÏÑ∏</div>
      <div id="modalBody"></div>
    </div>
  </div>

  <script>
    /* ---------- Element refs ---------- */
    let calendar;
    const todoForm = document.getElementById("todo-form");
    const todoInput = document.getElementById("todo-input");
    const todoLocation = document.getElementById("todo-location");
    const todoCategory = document.getElementById("todo-category");
    const todoDate = document.getElementById("todo-date");
    const todoDeadline = document.getElementById("todo-deadline");
    const todoList = document.getElementById("todo-list");
    const deletedList = document.getElementById("deleted-list");
    const deleteSelectedBtn = document.getElementById("delete-selected");
    const selectTodayBtn = document.getElementById("select-today");
    const toggleDeletedBtn = document.getElementById("toggle-deleted");
    const completedContainer = document.getElementById("completed-todos");
    const frequentContainer = document.getElementById("frequent-todos");
    const resetStorageBtn = document.getElementById("reset-storage");
    const toggleThemeBtn = document.getElementById("toggle-theme");
    const modal = document.getElementById("eventModal");
    const modalClose = document.getElementById("modalClose");
    const modalBody = document.getElementById("modalBody");

    

    /* ---------- State ---------- */
    let frequencyMap = JSON.parse(localStorage.getItem("taskFrequencies")) || {};
    let deletedTodos = [];

    /* ---------- Init ---------- */
    document.addEventListener("DOMContentLoaded", function () {
      emailjs.init("--OcvcHXArVW3U7Z_");
      calendar = new FullCalendar.Calendar(document.getElementById("calendar"), {
        initialView: 'dayGridMonth',
        height: 500,
        events: [],
        eventClick: function(info) {
        const { title, start, end } = info.event;
        modalBody.innerHTML = `
          <p><strong>Ìï† Ïùº:</strong> ${title}</p>
          <p><strong>ÎÇ†Ïßú:</strong> ${start.toISOString().split("T")[0]}</p>
          <p><strong>ÎßàÍ∞êÏùº:</strong> ${end ? new Date(end.getTime() - 86400000).toISOString().split("T")[0] : "-"}</p>
          `;
        modal.style.display = "flex";
      }
    }); 
      calendar.render();

      const savedTodos = JSON.parse(localStorage.getItem("todos")) || [];
      const savedDeleted = JSON.parse(localStorage.getItem("deletedTodos")) || [];
      savedTodos.forEach(todo => addTodo(todo.text, todo.date, todo.deadline, todo.location, todo.category, todo.completed));
      deletedTodos = savedDeleted;
      updateSideLists();
      modalClose.addEventListener("click", () => modal.style.display = "none");
      window.addEventListener("click", (e) => { if (e.target === modal) modal.style.display = "none"; });

      if (localStorage.getItem("darkMode") === "true") {
        document.body.classList.add("dark-mode");
      }
      
      
    /* ---------- EmailJS ÌîºÎìúÎ∞± ---------- */
    const toggleFeedbackBtn = document.getElementById("toggle-feedback");
    const feedbackFormContainer = document.getElementById("feedback-form-container");
    const feedbackInput = document.getElementById("feedback-input");
    const submitFeedbackBtn = document.getElementById("submit-feedback");

    toggleFeedbackBtn.addEventListener("click", () => {
      feedbackFormContainer.style.display = feedbackFormContainer.style.display === "none" ? "block" : "none";
    });

    submitFeedbackBtn.addEventListener("click", () => {
      const message = feedbackInput.value.trim();
      if (!message) return alert("ÌîºÎìúÎ∞±ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.");

      emailjs.send("hooneee99", "template_j5w43rd", {
        message,
        from_name: "ÏÇ¨Ïö©Ïûê"
      })
      .then(() => {
        alert("ÌîºÎìúÎ∞±Ïù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÑÏÜ°ÎêòÏóàÏäµÎãàÎã§!");
        feedbackInput.value = "";
        feedbackFormContainer.style.display = "none";
      })
      .catch(err => {
        console.error(err);
        alert("Ï†ÑÏÜ° Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
      });
    });

    });

    /* ---------- Todo Form Submit ---------- */
    todoForm.addEventListener("submit", function (e) {
      e.preventDefault();
      const text = todoInput.value.trim();
      const location = todoLocation.value.trim();
      const category = todoCategory.value;
      const date = todoDate.value || new Date().toISOString().split('T')[0];
      const deadline = todoDeadline.value || date;
      if (text) {
        addTodo(text, date, deadline, location, category);
        todoInput.value = "";
        todoLocation.value = "";
        todoCategory.value = "";
        todoDate.value = "";
        todoDeadline.value = "";
      }
    });

    /* ---------- Select Today's Todos ---------- */
    selectTodayBtn.addEventListener("click", () => {
      const today = new Date().toISOString().split('T')[0];
      document.querySelectorAll(".todo-item").forEach(item => {
        const checkbox = item.querySelector("input[type=checkbox]");
        checkbox.checked = (item.dataset.date === today || item.dataset.deadline === today);
      });
    });

    /* ---------- Delete Selected ---------- */
    deleteSelectedBtn.addEventListener("click", () => {
      const items = document.querySelectorAll(".todo-item");
      items.forEach(item => {
        const checkbox = item.querySelector("input[type=checkbox]");
        if (checkbox.checked) {
          deletedTodos.push({
            text: item.dataset.text,
            date: item.dataset.date,
            deadline: item.dataset.deadline,
            location: item.dataset.location,
            category: item.dataset.category
          });
          removeCalendarEvent(item.dataset.text);
          item.remove();
        }
      });
      saveTodos();
    });

    /* ---------- Toggle Deleted List ---------- */
    toggleDeletedBtn.addEventListener("click", () => {
      const visible = deletedList.style.display === "none";
      deletedList.style.display = visible ? "block" : "none";
      if (visible) updateDeletedList();
    });

    function updateDeletedList() {
      deletedList.innerHTML = "";
      deletedTodos.forEach((todo, index) => {
        const li = document.createElement("li");
        li.innerHTML = `
          ${todo.text}<br>
          ${todo.date} ~ ${todo.deadline}<br>
          üìç ${todo.location || "-"}<br>
          üè∑ ${todo.category || "-"}
        `;
        const restoreBtn = document.createElement("button");
        restoreBtn.textContent = "Î≥µÏõê";
        restoreBtn.classList.add("restore-btn");
        restoreBtn.addEventListener("click", () => {
          addTodo(todo.text, todo.date, todo.deadline, todo.location, todo.category);
          deletedTodos.splice(index, 1);
          updateDeletedList();  
          saveTodos();
        });
        li.appendChild(restoreBtn);
        deletedList.appendChild(li);
      });
      saveDeletedTodos();
    }

    function addTodo(text, date, deadline, location="", category="", completed=false) {
      const li = document.createElement("li");
      li.classList.add("todo-item");
      li.dataset.text = text;
      li.dataset.date = date;
      li.dataset.deadline = deadline;
      li.dataset.location = location;
      li.dataset.category = category;
      if (completed) li.classList.add("completed");

      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.classList.add("checkbox");

      const span = document.createElement("span");
      span.innerHTML = `
        ${text}<br>
        ${date} ~ ${deadline}<br>
        üìç ${location || "-"}<br>
        üè∑ ${category || "-"}
      `;
      span.addEventListener("click", function () {
        li.classList.toggle("completed");
        saveTodos();
      });

      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "ÏÇ≠Ï†ú";
      deleteBtn.classList.add("delete-btn");
      deleteBtn.addEventListener("click", function () {
        deletedTodos.push({ text, date, deadline, location, category });
        removeCalendarEvent(text);
        li.remove();
        saveTodos();
      });

      li.appendChild(checkbox);
      li.appendChild(span);
      li.appendChild(deleteBtn);
      todoList.appendChild(li);

      addCalendarEvent(text, date, deadline, location, category);
      trackFrequency(text);
      saveTodos();
    }

    function addCalendarEvent(title, start, end, location, category) {
      calendar.addEvent({ 
        title: `${title}${category ? " ["+category+"]" : ""}${location ? " @"+location : ""}`,
        start, end, allDay: true 
      });
    }
    function removeCalendarEvent(title) {
      calendar.getEvents().forEach(event => {
        if (event.title.includes(title)) event.remove();
      });
    }

    function saveTodos() {
      const todos = [];
      todoList.querySelectorAll(".todo-item").forEach(li => {
        todos.push({
          text: li.dataset.text,
          date: li.dataset.date,
          deadline: li.dataset.deadline,
          location: li.dataset.location,
          category: li.dataset.category,
          completed: li.classList.contains("completed")
        });
      });
      localStorage.setItem("todos", JSON.stringify(todos));
      saveDeletedTodos();
      updateSideLists();
    }
    function saveDeletedTodos() {
      localStorage.setItem("deletedTodos", JSON.stringify(deletedTodos));
    }

    function trackFrequency(text) {
      frequencyMap[text] = (frequencyMap[text] || 0) + 1;
      localStorage.setItem("taskFrequencies", JSON.stringify(frequencyMap));
    }

    function updateSideLists() {
      completedContainer.innerHTML = "";
      document.querySelectorAll(".todo-item.completed").forEach(item => {
        const li = document.createElement("li");
        li.className = "success-item";
        li.textContent = item.dataset.text;
        completedContainer.appendChild(li);
      });

      const sorted = Object.entries(frequencyMap).sort((a, b) => b[1] - a[1]);
      frequentContainer.innerHTML = "";
      sorted.slice(0, 10).forEach(([text, count]) => {
        const li = document.createElement("li");
        li.className = "frequent-item";
        li.innerHTML = `${text} <button onclick="quickAdd('${text}')">+</button>`;
        frequentContainer.appendChild(li);
      });
    }

    function quickAdd(text) {
      const today = new Date(Date.now() - new Date().getTimezoneOffset() * 60000)
  .toISOString().split('T')[0];
      addTodo(text, today, today);
    }
    window.quickAdd = quickAdd;

    resetStorageBtn.addEventListener("click", () => {
      if (confirm("Ï†ïÎßê Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå? Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎê©ÎãàÎã§.")) {
        localStorage.clear();
        location.reload();
      }
    });

    toggleThemeBtn.addEventListener("click", () => {
      document.body.classList.toggle("dark-mode");
      localStorage.setItem("darkMode", document.body.classList.contains("dark-mode"));
    });

  </script>
</body>
</html>
